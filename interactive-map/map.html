<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Map - Community Emergency Hub</title>
    <link rel="icon" type="image/png" href="../fdpr-logo.png">
    <link rel="stylesheet" href="styles.css">
    <!-- Include Leaflet CSS and JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <!-- Replace the current Couture font link with this one -->
    <link href="https://www.dafontfree.net/embed/Y291dHVyZS1ib2xkJmRhdGEvMjUvYy8xMjg3MjUvQ291dHVyZS1Cb2xkLm90Zg" rel="stylesheet" type="text/css" />
    <link href="https://fonts.cdnfonts.com/css/coolvetica" rel="stylesheet">
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
</head>

<body>
    <button class="menu-toggle" id="mobile-menu">
        <i class="fas fa-bars"></i>
    </button>
    <div class="container">
        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <h1>COMMUNITY<br>EMERGENCY HUB</h1>
            </div>

            <div class="tools">
                <h2>TOOLS</h2>
                <ul>
                    <li><a href="#" class="active"><i class="fas fa-map-marker-alt"></i> Interactive Map</a></li>
                    <li><a href="../first-aid/firstaid.html"><i class="fas fa-kit-medical"></i> First Aid Application</a></li>
                    <li><a href="../hotline/hotline.html"><i class="fas fa-phone"></i> Who to Call</a></li>
                    <li><a href="../"><i class="fas fa-home"></i> Homepage</a></li>
                </ul>
            </div>
        </aside>

        <main class="content">
            <div class="map-container">
                <div id="map"></div>
                <div class="info-panel" id="info-panel">
                    <button id="close-info" class="close-btn" onclick="closeInfoPanel()"><i class="fas fa-times"></i></button>
                    <h2>Location Information</h2>
                    <div id="info-content"></div>
                </div>
                <div id="imageModal" class="modal">
                    <span class="modal-close" onclick="closeModal()">&times;</span>
                    <img class="modal-content" id="modalImage">
                </div>
                <div class="map-controls">
                    <div class="dropdown">
                        <button class="map-btn dropdown-toggle"><i class="fas fa-layer-group"></i> Tools <i class="fas fa-chevron-down"></i></button>
                        <div class="dropdown-content">
                            <button class="map-btn" onclick="toggleFloodProne()"><i class="fas fa-water"></i> Flood-Prone Areas</button>
                            <button class="map-btn" onclick="toggleMedicalFacilities()"><i class="fas fa-clinic-medical"></i> Medical Facilities</button>
                            <button class="map-btn" onclick="toggleSchools()"><i class="fas fa-school"></i> Schools</button>
                            <button class="map-btn" onclick="toggleSportsVenues()"><i class="fas fa-basketball-ball"></i> Courts</button>
                            <button class="map-btn" onclick="toggleCommunityCenters()"><i class="fas fa-users"></i> Community Centers</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script src="script.js"></script>

    <script>
        // Initialize the map centered on Valenzuela City
        const map = L.map('map', {
            zoomControl: false // Disable default zoom control to reposition it
        }).setView([14.675101722172926, 120.98265022929283],16);
        
        // Add zoom control to bottom right
        L.control.zoom({
            position: 'bottomright'
        }).addTo(map);

        // Variables for tracking states
        let isInfoPanelOpen = false;
        let currentImageIndex = 0;
        let images = [];

        // Carousel and Modal Functions
        function moveCarousel(direction) {
            const track = document.querySelector('.carousel-track');
            const items = track.children.length;
            if (items === 0) return;

            currentImageIndex = (currentImageIndex + direction + items) % items;
            track.style.transform = `translateX(-${currentImageIndex * 100}%)`;
        }

        function openModal(imgSrc) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            modal.style.display = 'block';
            modalImg.src = imgSrc;
            // Allow DOM to update before adding show class
            requestAnimationFrame(() => {
                modal.classList.add('show');
            });
        }

        function closeModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.remove('show');
            // Wait for transition to complete before hiding
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function updateCarousel(locationImages) {
            const track = document.querySelector('.carousel-track');
            track.innerHTML = '';
            currentImageIndex = 0;
            images = locationImages;

            locationImages.forEach((imgSrc, index) => {
                const item = document.createElement('div');
                item.className = 'carousel-item';
                const img = document.createElement('img');
                img.src = imgSrc;
                img.onclick = () => openModal(imgSrc);
                item.appendChild(img);
                track.appendChild(item);
            });

            track.style.transform = 'translateX(0)';
        }

        // Function to create a marker with popup and hover effect
        function createMarker(lat, lng, title, description, icon) {
            const customIcon = L.icon({
                iconUrl: icon || 'fdpr-red.png',
                iconSize: [45, 41],
                iconAnchor: [12, 41],
                popupAnchor: [0, -41],
                className: 'custom-marker-icon'
            });
            const marker = L.marker([lat, lng], {
                icon: customIcon
            });
        
            // Create a tooltip with the description
            marker.bindTooltip(`<div class="marker-tooltip"><h3>${title}</h3><p>${description}</p></div>`, {
                direction: 'auto',
                offset: L.point(0, -30),
                className: 'custom-tooltip',
                opacity: 0.9
            });
        
            // Show tooltip on hover
            marker.on('mouseover', function(e) {
                this.openTooltip();
            });
        
            // Hide tooltip when mouse leaves
            marker.on('mouseout', function(e) {
                this.closeTooltip();
            });
        
            // Function to show location info panel
            const showLocationInfo = () => {
                const infoPanel = document.getElementById('info-panel');
                const isCurrentlyOpen = infoPanel.style.right === '0px';
        
                // Toggle panel visibility based on screen size
                const isMobile = window.innerWidth <= 768;
                if (isMobile) {
                    infoPanel.style.bottom = isCurrentlyOpen ? '-100%' : '0';
                } else {
                    infoPanel.style.right = isCurrentlyOpen ? '-300px' : '0';
                }
                isInfoPanelOpen = !isCurrentlyOpen;
            };
        
            // Add click handler to marker
            marker.on('click', showLocationInfo);
        
            // Create label with click handler
            const label = L.marker([lat, lng], {
                icon: L.divIcon({
                    className: 'map-label',
                    html: `<div class="clickable-label" style="cursor: pointer;">${title}</div>`,
                    iconSize: [200, 20],
                    iconAnchor: [100, 0]
                })
            }).on('click', showLocationInfo);
        
            return { marker, label };
        }

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        }).addTo(map);

        // Initialize dropdown functionality
        const dropdownToggle = document.querySelector('.dropdown-toggle');
        const dropdownContent = document.querySelector('.dropdown-content');

        dropdownToggle.addEventListener('click', (event) => {
            event.stopPropagation(); // Prevent event from bubbling up
            dropdownContent.classList.toggle('show');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (event) => {
            if (!event.target.closest('.dropdown')) {
                dropdownContent.classList.remove('show');
            }
        });

        // Map control functions
        let evacuationMarkers = [];
        let floodOverlay = null;
        let facilityMarkers = [];
        let floodLabel = null;
        let isEvacuationVisible = false;
        let isFloodVisible = false;
        let isFacilitiesVisible = false;
        let medicalMarkers = [];
        let schoolMarkers = [];
        let sportsMarkers = [];
        let communityMarkers = [];
        let isMedicalVisible = false;
        let isSchoolsVisible = false;
        let isSportsVisible = false;
        let isCommunityVisible = false;


        function toggleFloodProne() {
            const button = document.querySelector('button[onclick="toggleFloodProne()"]');
            if (isFloodVisible) {
                // Remove existing overlay and label
                if (floodOverlay) {
                    floodOverlay.remove();
                    floodOverlay = null;
                }
                if (floodLabel) {
                    floodLabel.remove();
                    floodLabel = null;
                }
                isFloodVisible = false;
                button.classList.remove('active');
            button.style.backgroundColor = '';
            } else {
                // Define flood-prone area polygon
                const floodArea = [
                    [14.6780, 120.9720],
                    [14.6775, 120.9740],
                    [14.6760, 120.9745],
                    [14.6755, 120.9725],
                    [14.6780, 120.9720]
                ];

                // Add polygon overlay
                floodOverlay = L.polygon(floodArea, {
                    color: 'red',
                    fillColor: '#f03',
                    fillOpacity: 0.3
                }).bindPopup('High-risk flood area').addTo(map);

                // Add label for flood area
                const floodCenter = [
                    (floodArea[0][0] + floodArea[2][0]) / 2,
                    (floodArea[0][1] + floodArea[2][1]) / 2
                ];
                floodLabel = L.marker(floodCenter, {
                    icon: L.divIcon({
                        className: 'map-label flood-label',
                        html: '<div>Flood-Prone Area</div>',
                        iconSize: [100, 20],
                        iconAnchor: [50, 0]
                    })
                }).addTo(map);
                isFloodVisible = true;
                button.classList.add('active');
            button.style.backgroundColor = '#FF4444';
            }
        }

        function toggleMedicalFacilities() {
            const button = document.querySelector('button[onclick="toggleMedicalFacilities()"]');
            if (isMedicalVisible) {
                medicalMarkers.forEach(marker => {
                    marker.marker.remove();
                    marker.label.remove();
                });
                medicalMarkers = [];
                isMedicalVisible = false;
                button.classList.remove('active');
            button.style.backgroundColor = '';
            } else {
                const facilities = [{
                    name: 'Fatima University Medical Center',
                    address: '120 MacArthur Hwy, Valenzuela, 1440 Metro Manila',
                    coords: [14.67797, 120.98095],
                    description: 'Fatima University Medical Center (FUMC) is a tertiary hospital and teaching facility serving as a crucial medical resource in Barangay Marulas. During flood emergencies, FUMC provides critical care and handles both minor injuries and complex medical cases. Its location near major roads makes it accessible for ambulatory services, while its affiliation with Our Lady of Fatima University ensures a steady supply of medical professionals during disaster response operations. FUMC also supports medical missions and relief operations during times of crisis.',
                    images: [
                        'assets/medical/fatima_1.jpg',
                        'assets/medical/fatima_2.jpg',
                        'assets/medical/fatima_3.jpg'
                    ]
                }, {
                    name: 'E. Perlas Diagnostic and Polyclinic',
                    address: '93 Pio Valenzuela, Valenzuela, 1440 Metro Manila',
                    coords: [14.6810, 120.9785],
                    description: 'E. Perlas Diagnostics and Polyclinic is a community-based healthcare provider offering outpatient services and diagnostic support. While not a large-scale hospital, it plays an important role during floods by providing immediate medical attention for minor injuries and health concerns. Its quick response capability, especially in low-level flood events, helps decongest larger hospitals and ensures more widespread medical coverage across the barangay.',
                    images: [
                        'assets/medical/perlas_1.jfif',
                        'assets/medical/perlas_2.jpg',
                        'assets/medical/perlas_3.png'
                    ]
                }, {
                    name: 'Calalang General Hospital',
                    address: '4th St, Valenzuela, 1440 Metro Manila',
                    coords: [14.67269, 120.98253],
                    description: 'Calalang General Hospital is a well-established private hospital in the heart of Marulas, equipped to manage a range of medical emergencies. During flood events, it serves as both a treatment facility and a support center for barangay-level disaster response. Its central location and capacity for overnight care make it a reliable option for patients needing continuous observation. The hospital also partners with local government units to coordinate relief and medical assistance during high-risk weather conditions.',
                    images: [
                        'assets/medical/calalang_1.jfif',
                        'assets/medical/calalang_2.jpg',
                        'assets/medical/calalang_3.jpg'
                    ]
                }];

                facilities.forEach(facility => {
                    const marker = L.marker(facility.coords, {
                        icon: L.icon({
                            iconUrl: 'fdpr-red.png',
                            iconSize: [45, 41],
                            iconAnchor: [12, 41],
                            popupAnchor: [0, -41],
                            className: 'custom-marker-icon'
                        })
                    })
                        .on('click', () => {
                            const infoPanel = document.getElementById('info-panel');
                            const isCurrentlyOpen = infoPanel.style.right === '0px';

                            document.getElementById('info-content').innerHTML = `
                                <h3>${facility.name}</h3>
                                <p><strong>Address:</strong> ${facility.address}</p>
                                <p><strong>Location:</strong> ${facility.coords[0].toFixed(4)}, ${facility.coords[1].toFixed(4)}</p>
                                <p>${facility.description}</p>
                                <div class="carousel-container">
                                    <div class="carousel-track">
                                        ${facility.images.map((imgSrc, index) => `
                                            <div class="carousel-item">
                                                <img src="${imgSrc}" onclick="openModal('${imgSrc}')" alt="${facility.name} Image ${index + 1}">
                                            </div>
                                        `).join('')}
                                    </div>
                                    <button class="carousel-btn prev" onclick="moveCarousel(-1)"><i class="fas fa-chevron-left"></i></button>
                                    <button class="carousel-btn next" onclick="moveCarousel(1)"><i class="fas fa-chevron-right"></i></button>
                                </div>
                            `;

                            // Toggle panel visibility based on screen size
                            const isMobile = window.innerWidth <= 768;
                            
                            if (isMobile) {
                                infoPanel.style.bottom = isCurrentlyOpen ? '-100%' : '0';
                            } else {
                                infoPanel.style.right = isCurrentlyOpen ? '-300px' : '0';
                            }
                            isInfoPanelOpen = !isCurrentlyOpen;
                        })
                        .addTo(map);

                    const label = L.marker(facility.coords, {
                        icon: L.divIcon({
                            className: 'map-label medical-label',
                            html: `<div>${facility.name}</div>`,
                            iconSize: [200, 20],
                            iconAnchor: [100, 0]
                        })
                    }).addTo(map);

                    medicalMarkers.push({
                        marker,
                        label
                    });
                });
                isMedicalVisible = true;
                button.classList.add('active');
            button.style.backgroundColor = '#FF4444';
            }
        }

        function toggleSchools() {
            const button = document.querySelector('button[onclick="toggleSchools()"]');
            if (isSchoolsVisible) {
                schoolMarkers.forEach(marker => {
                    marker.marker.remove();
                    marker.label.remove();
                });
                schoolMarkers = [];
                isSchoolsVisible = false;
                button.classList.remove('active');
            button.style.backgroundColor = '';
            } else {
                const schools = [{
                    name: 'Valenzuela National High School',
                    address: '4 A. Fernando Street, Valenzuela, Metro Manila',
                    coords: [14.6830, 120.9805],
                    description: 'As one of the largest educational institutions in the area, Valenzuela National High School is a major strategic site for flood disaster management. It has the capacity to host large numbers of evacuees and is often used as a central command point during city-wide disaster responses. The school community is actively involved in preparedness campaigns, including student-led initiatives that promote safety awareness and resilience. Its elevated location and ample facilities make it a cornerstone of emergency planning in Marulas.',
                    images: [
                        'assets/school/valenzuela_1.png',
                        'assets/school/valenzuela_2.png',
                        'assets/school/valenzuela_3.jpg'
                    ]
                },{
                    name: 'Serrano Elementary School',
                    address: 'T. Serrano St, Valenzuela, Metro Manila',
                    coords: [14.6870, 120.9845],
                    description: 'Serrano Elementary School plays a significant role in the local disaster preparedness framework. Positioned within a residential area, the school is a primary evacuation site for nearby households during flooding events. Its facilities have been used in previous emergencies for shelter and relief operations. With its active school community, Serrano is also a hub for public education on flood safety and emergency response, helping instill preparedness values among students and their families.',
                    images: [
                        'assets/school/serrano_1.jpg',
                        'assets/school/serrano_2.jpg',
                        'assets/school/serrano_3.jpg'
                    ]
                },{
                    name: 'Marulas Central School',
                    address: 'Pio Valenzuela, Valenzuela, 1440 Metro Manila',
                    coords: [14.67601337707112, 120.98498637949744],
                    description: 'Marulas Central School is one of the key public institutions in Barangay Marulas and serves as an important facility for community gatherings and disaster response coordination. In times of flooding, the school is designated as an emergency evacuation site due to its central location and spacious facilities. Its accessibility and proximity to main roads make it a vital point in the barangay\'s flood response network. Strengthening disaster preparedness activities here, such as community drills and information campaigns, enhances the overall resilience of the area.',
                    images: [
                        'assets/school/marulas_1.jpg',
                        'assets/school/marulas_2.jpg',
                        'assets/school/marulas_3.png'
                    ]
                    },{
                    name: 'Bitik Elementary School',
                    address: 'Tamaraw Hills Ext, Valenzuela, Metro Manila',
                    coords: [14.680180922064459, 120.98651613531823],
                    description: 'Bitik Elementary School serves a densely populated section of Barangay Marulas and is an essential node in the flood disaster response network. Due to its location in a flood-prone zone, the school is critical for early evacuation efforts. It also functions as a temporary shelter during severe weather events. Regular coordination with barangay officials and integration of disaster risk reduction education into the curriculum ensures that Bitik Elementary is always ready to respond in times of need.',
                    images: [
                        'assets/school/bitik_1.png',
                        'assets/school/bitik_2.jpg',
                        'assets/school/bitik_3.jpg'
                    ]
                }];

                schools.forEach(school => {
                    const marker = L.marker(school.coords, {
                        icon: L.icon({
                            iconUrl: 'fdpr-red.png',
                            iconSize: [45, 41],
                            iconAnchor: [12, 41],
                            popupAnchor: [0, -41],
                            className: 'custom-marker-icon'
                        })
                    })
                        .on('click', () => {
                            const infoPanel = document.getElementById('info-panel');
                            const isCurrentlyOpen = infoPanel.style.right === '0px';

                            document.getElementById('info-content').innerHTML = `
                                <h3>${school.name}</h3>
                                <p><strong>Address:</strong> ${school.address}</p>
                                <p><strong>Location:</strong> ${school.coords[0].toFixed(4)}, ${school.coords[1].toFixed(4)}</p>
                                <p>${school.description}</p>
                                <div class="carousel-container">
                                    <div class="carousel-track">
                                        ${school.images.map((imgSrc, index) => `
                                            <div class="carousel-item">
                                                <img src="${imgSrc}" onclick="openModal('${imgSrc}')" alt="${school.name} Image ${index + 1}">
                                            </div>
                                        `).join('')}
                                    </div>
                                    <button class="carousel-btn prev" onclick="moveCarousel(-1)"><i class="fas fa-chevron-left"></i></button>
                                    <button class="carousel-btn next" onclick="moveCarousel(1)"><i class="fas fa-chevron-right"></i></button>
                                </div>
                            `;

                            // Toggle panel visibility based on screen size
                            const isMobile = window.innerWidth <= 768;
                            
                            if (isMobile) {
                                infoPanel.style.bottom = isCurrentlyOpen ? '-100%' : '0';
                            } else {
                                infoPanel.style.right = isCurrentlyOpen ? '-300px' : '0';
                            }
                            isInfoPanelOpen = !isCurrentlyOpen;
                        })
                        .addTo(map);

                    const label = L.marker(school.coords, {
                        icon: L.divIcon({
                            className: 'map-label school-label',
                            html: `<div>${school.name}</div>`,
                            iconSize: [200, 20],
                            iconAnchor: [100, 0]
                        })
                    }).addTo(map);

                    schoolMarkers.push({
                        marker,
                        label
                    });
                });
                isSchoolsVisible = true;
                button.classList.add('active');
            button.style.backgroundColor = '#FF4444';
            }
        }

        function toggleSportsVenues() {
            const button = document.querySelector('button[onclick="toggleSportsVenues()"]');
            if (isSportsVisible) {
                sportsMarkers.forEach(marker => {
                    marker.marker.remove();
                    marker.label.remove();
                });
                sportsMarkers = [];
                isSportsVisible = false;
                button.classList.remove('active');
            button.style.backgroundColor = '';
            } else {
                const venues = [{
                    name: 'THOA Wild Center',
                    address: 'THOA Covered Court, GTDL, Valenzuela City',
                    coords: [14.682998859302277, 120.98803948610599],
                    description:'The THOA Wild Center, primarily used for recreational and community activities, can double as a flexible response space during flood-related emergencies. Its open area and accessible layout make it suitable for temporary evacuation or relief operations, particularly in the early stages of a disaster. The center also provides an opportunity to engage the community in educational workshops focused on flood risk awareness and preparedness strategies.',
                    images: [
                        'assets/court/thoa_1.jpg',
                        'assets/court/thoa_2.jpg',
                        'assets/court/thoa_3.jpg',
                    ]
                }, {
                    name: 'Manotoc Basketball Court',
                    address: '58 Manotoc, Valenzuela, 1440 Metro Manila',
                    coords: [14.68306, 120.97972],
                    description:' The Manotoc Covered Basketball Court is a critical public space often repurposed as an emergency shelter during floods. Its wide, sheltered layout is ideal for housing evacuees and organizing relief goods. Frequently used for barangay assemblies and community drills, the court is also a familiar and trusted gathering point that enhances coordination during high-alert weather events. Its role in hosting community preparedness activities makes it a vital asset in local flood response efforts.',
                    images: [
                        'assets/court/manotoc_1.jpg',
                        'assets/court/manotoc_2.jpg',
                        'assets/court/manotoc_3.jpg',
                    ]
                }, {
                    name: 'Elysian Court',
                    address: 'Engracion, Valenzuela, 1440 Metro Manila',
                    coords: [14.674347926774262, 120.97964155436341],
                    description:'Elysian Court is a residential complex that plays a minor yet strategic role in localized disaster preparedness. As a community living area, it can serve as a checkpoint or temporary staging area during flood emergencies, especially for organizing neighborhood evacuations or aid distribution. With proper coordination, it can also function as a platform for disseminating emergency alerts and preparedness information among residents.',
                    images: [
                        'assets/court/elysian_1.png',
                        'assets/court/elysian_2.png',
                        'assets/court/elysian_3.png',
                    ]
                }];

                venues.forEach(venue => {
                    const marker = L.marker(venue.coords, {
                        icon: L.icon({
                            iconUrl: 'fdpr-red.png',
                            iconSize: [45, 41],
                            iconAnchor: [12, 41],
                            popupAnchor: [0, -41],
                            className: 'custom-marker-icon'
                        })
                    })
                        .on('click', () => {
                            const infoPanel = document.getElementById('info-panel');
                            const isCurrentlyOpen = infoPanel.style.right === '0px';

                            document.getElementById('info-content').innerHTML = `
                                <h3>${venue.name}</h3>
                                <p><strong>Location:</strong> ${venue.address}</p>
                                <p><strong>Location:</strong> ${venue.coords[0].toFixed(4)}, ${venue.coords[1].toFixed(4)}</p>
                                <p>${venue.description}</p>
                                <div class="carousel-container">
                                    <div class="carousel-track">
                                        ${venue.images.map((imgSrc, index) => `
                                            <div class="carousel-item">
                                                <img src="${imgSrc}" onclick="openModal('${imgSrc}')" alt="${venue.name} Image ${index + 1}">
                                            </div>
                                        `).join('')}
                                    </div>
                                    <button class="carousel-btn prev" onclick="moveCarousel(-1)"><i class="fas fa-chevron-left"></i></button>
                                    <button class="carousel-btn next" onclick="moveCarousel(1)"><i class="fas fa-chevron-right"></i></button>
                                </div>
                            `;

                            // Toggle panel visibility based on screen size
                            const isMobile = window.innerWidth <= 768;
                            
                            if (isMobile) {
                                infoPanel.style.bottom = isCurrentlyOpen ? '-100%' : '0';
                            } else {
                                infoPanel.style.right = isCurrentlyOpen ? '-300px' : '0';
                            }
                            isInfoPanelOpen = !isCurrentlyOpen;
                        })
                        .addTo(map);

                    const label = L.marker(venue.coords, {
                        icon: L.divIcon({
                            className: 'map-label sports-label',
                            html: `<div>${venue.name}</div>`,
                            iconSize: [200, 20],
                            iconAnchor: [100, 0]
                        })
                    }).addTo(map);

                    sportsMarkers.push({
                        marker,
                        label
                    });
                });
                isSportsVisible = true;
                button.classList.add('active');
            button.style.backgroundColor = '#FF4444';
            }
        }

        function toggleCommunityCenters() {
            const button = document.querySelector('button[onclick="toggleCommunityCenters()"]');
            if (isCommunityVisible) {
                // Remove existing markers
                communityMarkers.forEach(marker => {
                    marker.marker.remove();
                    marker.label.remove();
                });
                communityMarkers = [];
                isCommunityVisible = false;
                button.classList.remove('active');
            button.style.backgroundColor = '';
            } else {
                // Community center locations
                const centers = [{
                    name: '3S Center Marulas',
                    address: 'Marulas Market, Valenzuela, Metro Manila',
                    coords: [14.674130969163468, 120.98293965436353],
                    description:'The 3S Center (Service, Support & Solutions) in Marulas is a vital hub for local governance and public service delivery. During flood events, it serves as a command post for coordinating disaster response efforts, including evacuation, relief distribution, and real-time updates. It also houses records and planning tools that aid in risk assessment and mitigation. As a barangay-level operations center, the 3S Center plays a key role in ensuring rapid, organized, and community-focused response during times of crisis.',
                    images: [
                        'assets/evac/3s_1.jpg',
                        'assets/evac/3s_2.jpg',
                        'assets/evac/3s_3.jpg',
                    ]
                },{
                    name: 'MNDZ Evacuation Center',
                    address: '2007 T. Santiago, Valenzuela, Metro Manila',
                    coords: [14.6896373612385, 120.9862151419276],
                    description:'The MNDZ Evacuation Center is a designated safe haven during flood emergencies in Barangay Marulas. Purpose-built for disaster scenarios, it is equipped to accommodate evacuees with essential amenities such as sleeping areas, sanitation facilities, and basic medical support. The center also serves as a logistics base for distributing relief goods and coordinating rescue operations. Its strategic location and dedicated function make it one of the most important assets in the community\'s flood preparedness and response infrastructure.',
                    images: [
                        'assets/evac/mndz_1.png',
                        'assets/evac/mndz_2.jfif',
                        'assets/evac/mndz_3.jpg',
                    ]
                }];

                // Add markers
                centers.forEach(center => {
                    const marker = L.marker(center.coords, {
                        icon: L.icon({
                            iconUrl: 'fdpr-red.png',
                            iconSize: [45, 41],
                            iconAnchor: [12, 41],
                            popupAnchor: [0, -41],
                            className: 'custom-marker-icon'
                        })
                    })
                        .on('click', () => {
                            const infoPanel = document.getElementById('info-panel');
                            const isCurrentlyOpen = infoPanel.style.right === '0px';

                            document.getElementById('info-content').innerHTML = `
                                <h3>${center.name}</h3>
                                <p><strong>Address:</strong> ${center.address}</p>
                                <p><strong>Location:</strong> ${center.coords[0].toFixed(4)}, ${center.coords[1].toFixed(4)}</p>
                                <p>${center.description}</p>
                                <div class="carousel-container">
                                    <div class="carousel-track">
                                        ${center.images.map((imgSrc, index) => `
                                            <div class="carousel-item">
                                                <img src="${imgSrc}" onclick="openModal('${imgSrc}')" alt="${center.name} Image ${index + 1}">
                                            </div>
                                        `).join('')}
                                    </div>
                                    <button class="carousel-btn prev" onclick="moveCarousel(-1)"><i class="fas fa-chevron-left"></i></button>
                                    <button class="carousel-btn next" onclick="moveCarousel(1)"><i class="fas fa-chevron-right"></i></button>
                                </div>
                            `;

                            // Toggle panel visibility based on screen size
                            const isMobile = window.innerWidth <= 768;
                            
                            if (isMobile) {
                                infoPanel.style.bottom = isCurrentlyOpen ? '-100%' : '0';
                            } else {
                                infoPanel.style.right = isCurrentlyOpen ? '-300px' : '0';
                            }
                            isInfoPanelOpen = !isCurrentlyOpen;
                        })
                        .addTo(map);

                    const label = L.marker(center.coords, {
                        icon: L.divIcon({
                            className: 'map-label community-label',
                            html: `<div>${center.name}</div>`,
                            iconSize: [150, 20],
                            iconAnchor: [75, 0]
                        })
                    }).addTo(map);

                    communityMarkers.push({
                        marker,
                        label
                    });
                });
                isCommunityVisible = true;
                button.classList.add('active');
            button.style.backgroundColor = '#FF4444';
            }
        }
        // Function to close the info panel
        function closeInfoPanel() {
            const infoPanel = document.getElementById('info-panel');
            const isMobile = window.innerWidth <= 768;
            
            if (isMobile) {
                infoPanel.style.bottom = '-100%';
            } else {
                infoPanel.style.right = '-300px';
            }
            isInfoPanelOpen = false;
        }

        document.addEventListener('DOMContentLoaded', function() {
            const dropdownToggle = document.querySelector('.dropdown-toggle');
            const dropdownContent = document.querySelector('.dropdown-content');
            const mobileMenu = document.getElementById('mobile-menu');
            const sidebar = document.getElementById('sidebar');
            
            // Mobile menu toggle functionality
            mobileMenu.addEventListener('click', function() {
                sidebar.classList.toggle('active');
                mobileMenu.classList.toggle('active');
            });
            
            // Close sidebar when clicking outside
            document.addEventListener('click', function(event) {
                if (!sidebar.contains(event.target) && !mobileMenu.contains(event.target) && sidebar.classList.contains('active')) {
                    sidebar.classList.remove('active');
                    mobileMenu.classList.remove('active');
                }
            });
            
            // Handle touch swipe to close sidebar
            let touchStartX = 0;
            let touchEndX = 0;
            
            sidebar.addEventListener('touchstart', function(event) {
                touchStartX = event.touches[0].clientX;
            });
            
            sidebar.addEventListener('touchend', function(event) {
                touchEndX = event.changedTouches[0].clientX;
                if (touchStartX > touchEndX && sidebar.classList.contains('active')) {
                    sidebar.classList.remove('active');
                    mobileMenu.classList.remove('active');
                }
            });

            // Dropdown functionality
            if (dropdownToggle && dropdownContent) {
                dropdownToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    dropdownContent.classList.toggle('show');
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', function(e) {
                    if (!dropdownToggle.contains(e.target) && !dropdownContent.contains(e.target)) {
                        dropdownContent.classList.remove('show');
                    }
                });

                // Prevent dropdown from closing when clicking inside it
                dropdownContent.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
            
            // Handle window resize to adjust info panel position
            window.addEventListener('resize', function() {
                if (isInfoPanelOpen) {
                    const infoPanel = document.getElementById('info-panel');
                    const isMobile = window.innerWidth <= 768;
                    
                    if (isMobile) {
                        infoPanel.style.right = '';
                        infoPanel.style.bottom = '0';
                    } else {
                        infoPanel.style.bottom = '';
                        infoPanel.style.right = '0';
                    }
                }
            });
        });
    </script>
</body>

</html>